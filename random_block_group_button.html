<!DOCTYPE html>
<html>
<head>
  <title>Random Point Selector</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet-textpath@1.2.0/leaflet.textpath.min.js"></script>
  <script src='https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js'></script>
</head>
<body>
  <div id="map" style="width: 100%; height: 500px;"></div>
  <button id="generateButton">Generate Random Pair</button>

  <script>
    // Initialize the map
    var map = L.map('map').setView([45.52, -122.68], 12); 

    // Add a basemap (e.g., OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Load GeoJSON data from AWS S3
    fetch('https://meysohn-sandbox.s3.us-east-1.amazonaws.com/trimet_trip_planner/tm_route_buffer_blockgroup.geojson')
      .then(response => response.json())
      .then(data => {
        // Create a GeoJSON layer
        var geojsonLayer = L.geoJson(data).addTo(map);

        // Function to generate random pair of indices
        function generateRandomPair() {
          // Get the number of features
          var numFeatures = data.features.length;

          // Generate two unique random indices
          var index1 = Math.floor(Math.random() * numFeatures);
          var index2 = Math.floor(Math.random() * numFeatures);
          while (index2 === index1) {
            index2 = Math.floor(Math.random() * numFeatures);
          }

          // Clear existing styles
          geojsonLayer.resetStyle(); 

          // Style the selected features
          function highlightFeature(feature) {
            var selectedFeature = 
              feature === data.features[index1] || 
              feature === data.features[index2]; 
            return selectedFeature ? {
              weight: 5,
              color: '#666',
              dashArray: '',
              fillOpacity: 0.7
            } : {
              weight: 1,
              color: '#666',
              dashArray: '',
              fillOpacity: 0.1
            };
          }

          geojsonLayer.setStyle(highlightFeature);

          // Zoom to fit the selected features
          var bounds = L.featureGroup([
            L.geoJson(data.features[index1]),
            L.geoJson(data.features[index2])
          ]).getBounds();
          map.fitBounds(bounds);
        }

        // Add event listener to the button
        document.getElementById('generateButton').addEventListener('click', generateRandomPair);
      });
  </script>
</body>
</html>